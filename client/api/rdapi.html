<!-- ***** BEGIN LICENSE BLOCK *****
   - Version: MPL 1.1
   -
   - The contents of this file are subject to the Mozilla Public License Version
   - 1.1 (the "License"); you may not use this file except in compliance with
   - the License. You may obtain a copy of the License at
   - http://www.mozilla.org/MPL/
   -
   - Software distributed under the License is distributed on an "AS IS" basis,
   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
   - for the specific language governing rights and limitations under the
   - License.
   -
   - The Original Code is Raindrop.
   -
   - The Initial Developer of the Original Code is
   - Mozilla Messaging, Inc..
   - Portions created by the Initial Developer are Copyright (C) 2009
   - the Initial Developer. All Rights Reserved.
   -
   - Contributor(s):
   - -->

<!DOCTYPE html>
<html>
<head>
    <title>Raindrop API jQuery Plugin Test Page</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <link type="text/css" rel="stylesheet" href="rdapi.css">

    <script src="scripts/requireplugins-jquery-1.4.2.js" charset="utf-8"></script>
    <script>
        require(["jquery", "rdapi"], function ($, rdapi) {
            $(function () {
                $('body')
                .delegate('.list.subject', 'click', function (evt) {
                    var data = rdapi.data($(evt.target).parents('[data-blade-motif]').first().attr('data-blade-motif'));
                    rdapi('conversations/by_id?key=' + encodeURIComponent(JSON.stringify(data.id)) + '&schemas=%5B%22*%22%5D', {
                        templateId: 'fullConversation',
                        containerNode: document.getElementById('convDisplay')
                    });
                    evt.preventDefault();
                })
                .delegate('.fullConvClose', 'click', function (evt) {
                    $('#convDisplay').html('');
                    evt.preventDefault();
                });
            });
        });
    </script>
</head>
<body>

  <div id="header">

    <div class="row">
      <div class="c1 search">
      </div>
      <div class="c2">
        <li class="account">Andy Chung</li>
        <li>compose</li>
        <li>edit</li>
      </div>
      <div class="c3 logo">

      </div>
    </div>
  </div>

  <div class="inflow templateContainer">
    <div class="row template" data-api="conversations/personal">
      {. first messages[0].schemas['rd.msg.body']}
      {. from rdapi.identity(first.from)}
      <div class="c3">
        <span class="date">{first.timestamp} - via email</span>

        <span class="actions">hide delete</span>
      </div>
      <div class="c1">
        <div class="avatar"><!--{from.url}--></div>
        <div class="name">{from_display[0]}</div>
        <div class="twitterActions">
          <li>reply</li> 
          <li>forward</li>
          <li>&#x2605;</li>
        </div>
      </div>
      <div class="c2">
        <div class="subject"><a class="list subject" href="#">{subject}</a></div>
        <div class="messageBody">{first.body_preview}
        </div>
      </div>
      <div class="replies">
        {messages[1:] [}
            <div class="c3 reply">
            <div class="arrow"></div>
              {. body schemas['rd.msg.body']}
              <div class="messageReply noArrow">
                <span class="name">{body.from_display}</span> {body.body_preview}</div>
            </div>
        {]}
      </div> 
      <div class="c3">
        <div class="more"><a href="#">view all replies (<span class="totalReplies">{messages[1:].length}</span>)</a></div>
      </div>
    </div>
  </div>

<div class="widgets">
    <div class="row">
      <div class="c3 accounts">
        <li><span class="selected">Inflow</span></li>
        <li>Gmail</li>
        <li><span class="placeholder">Twitter</span></li>
          <li class="twitterOptions">@_andychung</li>
          <li class="twitterOptions">Direct Messages</li>
          <li class="twitterOptions">Favorites</li>
          <li class="twitterOptions">Retweets</li>
          <li class="twitterOptions">Lists</li>
      </div>
    </div>
    
    <div class="row">
      <div class="c3 folders">
        <div class="title">folders &mdash; show all &mdash; new folder</div>
          <li>Sent</li>
          <li>Travel</li>
          <li>Shopping</li>
          <li>Family</li>
          <li>Work</li>
      </div>
    </div>
    
    <div class="row">
      <div class="c3 broadcastMessages">

        <div class="title">broadcast messages &mdash; show all</div>
          <li>YVR</li>
          <li>Mozilla</li>
      </div>
    </div>
    
    <div class="row">

      <div class="c3 mailingListMessages">
        <div class="title">mailing list messages &mdash; show all</div>
          <li>Raindrop</li>
          <li>Thunderbird</li>
          <li>Jetpack</li>
          <li>Bespin</li>

      </div>
    </div>
  </div>

  <div class="conversation template widgets fullMessage" data-id="fullConversation">
    <div class="row">
      <div class="c3">
        <div class="actions"><a class="fullConvClose" href="#close">Close</a></div>
      </div>
      <div class="c3">
        <span class="subject">{subject}</span>
      </div>
    </div>
    {messages [}
      <div class="row fullReply">
        <div class="message">
          <div class="c2">
            <div class="avatar"></div>
            <div class="from name">{schemas['rd.msg.body'].from_display} <span class="date">on {schemas['rd.msg.body'].timestamp}</span></div>
          </div>
          <div class="c1">
            <div class="actions"><a class="fullConvClose" href="#close">Close</a></div>
          </div>
        </div>
        <div class="c3"> 
          <div class="messageBody">{schemas['rd.msg.body'].body}</div>
        </div>
        <div class="c3">
          <div class="actions">reply forward</div>
        </div> 
      </div>
      {]}
    </div>
  </div>

<div id="convDisplay"></div>
</body>
</html>

